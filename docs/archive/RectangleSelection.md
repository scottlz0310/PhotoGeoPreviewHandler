# 地図上での矩形選択機能

## 概要

地図上で複数の写真を一度に選択できる矩形選択機能を実装しました。この機能により、大量の写真を効率的に管理できます。

## 使い方

### 基本操作

1. **フォルダ内の写真を表示**
   - まず、GPS 情報を含む写真が入ったフォルダを開きます
   - 地図上に写真の位置がマーカーで表示されます

2. **矩形選択の開始**
   - **Ctrl キーを押しながら**地図上でマウスの左ボタンを押します
   - ドラッグを開始すると、半透明の青い矩形が表示されます

3. **選択範囲の調整**
   - マウスをドラッグしながら、選択したい写真を囲むように矩形を広げます
   - 矩形内に含まれる写真マーカーが選択対象になります

4. **選択の確定**
   - マウスボタンを離すと、矩形内の写真が自動的に選択されます
   - 左側のファイルリストでも対応する写真が選択状態になります

### 注意事項

- **Ctrl キーが必須**: Ctrl キーを押さずにドラッグすると、地図のパンニング（移動）になります
- **GPS 情報が必要**: 写真に GPS 情報が含まれていないと、地図上にマーカーが表示されません
- **複数選択**: 矩形選択で複数の写真を一度に選択できます
- **選択解除**: 新しい矩形選択を行うと、前の選択は解除されます

## 使用例

### シナリオ 1: 特定エリアの写真をまとめて選択

旅行先で撮影した写真のうち、特定の観光地で撮影した写真だけを選択したい場合：

1. フォルダを開いて地図上に写真マーカーを表示
2. 観光地のエリアをズームイン
3. Ctrl + ドラッグで該当エリアを囲む
4. 選択された写真に対して移動やコピーなどの操作を実行

### シナリオ 2: 密集した写真群の選択

同じ場所で撮影した多数の写真を選択したい場合：

1. 地図上で写真マーカーが密集しているエリアを表示
2. Ctrl + ドラッグで密集エリアを大きく囲む
3. すべての写真が一度に選択される
4. まとめて別のフォルダに移動できる

## 技術的な詳細

### 実装方法

- **使用ライブラリ**: Mapsui 5.0.2, NetTopologySuite 2.6.0
- **矩形選択レイヤー**: `MemoryLayer` を使用して矩形を地図上に描画
- **座標変換**: スクリーン座標とワールド座標の相互変換
- **衝突判定**: 矩形の範囲内にあるマーカーの検出

### コード構造

- `OnMapPointerPressed`: 矩形選択の開始処理
- `OnMapPointerMoved`: 矩形の描画更新
- `OnMapPointerReleased`: 選択の確定とファイルリスト更新
- `UpdateRectangleSelectionLayer`: 矩形レイヤーの描画
- `SelectPhotosInRectangle`: 矩形内の写真の検出と選択

## 今後の改善案

- Shift キーとの組み合わせで選択の追加/削除
- 矩形以外の選択形状（円形、多角形など）のサポート
- 選択範囲の視覚的なフィードバックの強化
- タッチスクリーンでの操作サポート
