# 戻る・進むボタン機能テストガイド

## 概要
このドキュメントでは、戻る・進むボタンのナビゲーション履歴機能の手動テスト方法を説明します。

## 機能説明
- **戻るボタン**: 以前に訪問したフォルダに戻ります
- **進むボタン**: 戻った後に、元のフォルダに進みます
- **履歴管理**: ブラウザと同様の動作（新しいフォルダに移動すると進む履歴がクリアされる）

## 前提条件
- Windows 10/11 環境
- .NET 10 Runtime がインストールされている
- アプリケーションがビルド済み

## ビルド手順

```powershell
# リポジトリのルートディレクトリで実行
dotnet build PhotoGeoExplorer.sln -c Release -p:Platform=x64
```

## 単体テスト実行

```powershell
# 単体テストを実行
dotnet test PhotoGeoExplorer.Tests --filter FullyQualifiedName~MainViewModelTests -c Release -p:Platform=x64
```

## 手動テスト手順

### テストケース 1: 基本的な戻る・進む操作

1. **アプリを起動**
   ```powershell
   dotnet run --project PhotoGeoExplorer/PhotoGeoExplorer.csproj -c Release -p:Platform=x64
   ```

2. **初期状態を確認**
   - 戻るボタンが無効（グレーアウト）されていることを確認
   - 進むボタンが無効（グレーアウト）されていることを確認

3. **フォルダを移動**
   - ホームボタン（家アイコン）をクリックして「ピクチャ」フォルダを開く
   - フォルダ一覧からサブフォルダをダブルクリックして移動
   - 戻るボタンが有効になることを確認
   - 進むボタンは無効のままであることを確認

4. **戻る操作**
   - 戻るボタンをクリック
   - 前のフォルダ（ピクチャフォルダ）に戻ることを確認
   - パンくずリストが正しく更新されることを確認
   - 戻るボタンが無効になることを確認
   - 進むボタンが有効になることを確認

5. **進む操作**
   - 進むボタンをクリック
   - サブフォルダに戻ることを確認
   - 戻るボタンが有効になることを確認
   - 進むボタンが無効になることを確認

### テストケース 2: 履歴のクリア

1. **複数のフォルダを移動**
   - フォルダA → フォルダB → フォルダC と順に移動
   - 戻るボタンが有効であることを確認

2. **戻る操作**
   - 戻るボタンを2回クリックしてフォルダAに戻る
   - 進むボタンが有効であることを確認（フォルダB、Cに進める）

3. **新しいフォルダに移動**
   - フォルダAから別のフォルダD（フォルダB、C以外）に移動
   - 進むボタンが無効になることを確認（履歴がクリアされた）
   - 戻るボタンは有効であることを確認

### テストケース 3: 他のナビゲーション操作との連携

1. **上へボタンとの連携**
   - サブフォルダにいる状態で「上へ」ボタンをクリック
   - 戻るボタンが有効になることを確認（履歴に追加される）

2. **パンくずリストとの連携**
   - パンくずリスト内のフォルダ名をクリックして移動
   - 戻るボタンが有効になることを確認

3. **ホームボタンとの連携**
   - ホームボタンをクリック
   - 戻るボタンが有効になることを確認

4. **フォルダを開くダイアログとの連携**
   - 「フォルダを開く」ダイアログから別のフォルダを選択
   - 戻るボタンが有効になることを確認

### テストケース 4: 連続操作

1. **連続して戻る**
   - 複数のフォルダを経由した後、戻るボタンを連続でクリック
   - すべての履歴を辿れることを確認
   - 最初のフォルダまで戻ったら戻るボタンが無効になることを確認

2. **連続して進む**
   - 連続して戻った後、進むボタンを連続でクリック
   - すべての履歴を辿れることを確認
   - 最後のフォルダまで進んだら進むボタンが無効になることを確認

### テストケース 5: エッジケース

1. **存在しないフォルダ**
   - フォルダAに移動後、外部でフォルダAを削除
   - 戻るボタンで削除されたフォルダAに戻ろうとする
   - エラーメッセージが表示されることを確認
   - 履歴が適切に処理されることを確認

2. **アクセス権限のないフォルダ**
   - アクセス権限のないフォルダに移動しようとする
   - エラーメッセージが表示されることを確認
   - ナビゲーション状態が不正にならないことを確認

## 期待される動作

### 正常系
- ✅ 戻るボタンは履歴がある時のみ有効
- ✅ 進むボタンは進める履歴がある時のみ有効
- ✅ 新しいフォルダに移動すると進む履歴がクリアされる
- ✅ すべてのナビゲーション操作で履歴が正しく管理される
- ✅ パンくずリストが常に現在位置を正確に表示

### 異常系
- ✅ 存在しないフォルダへの移動時にエラーメッセージを表示
- ✅ アクセス権限エラー時に適切なメッセージを表示
- ✅ エラー発生後もナビゲーション履歴が破損しない

## トラブルシューティング

### ボタンが有効にならない
- ViewModel のプロパティバインディングが正しいか確認
- `CanNavigateBack` / `CanNavigateForward` プロパティが正しく更新されているか確認

### 履歴が正しく保存されない
- `LoadFolderAsync` メソッドで `_isNavigating` フラグが正しく使用されているか確認
- `UpdateNavigationProperties()` が呼ばれているか確認

### 例外が発生する
- `%LocalAppData%\PhotoGeoExplorer\Logs\app.log` を確認
- スタックトレースからエラー箇所を特定

## ログの確認

ログファイルの場所:
```
%LocalAppData%\PhotoGeoExplorer\Logs\app.log
```

ナビゲーション関連のログを確認するには:
```powershell
Get-Content "$env:LOCALAPPDATA\PhotoGeoExplorer\Logs\app.log" | Select-String -Pattern "Navigate|Folder"
```

## CI での確認

GitHub Actions の CI で以下が自動実行されます:
- ビルドチェック
- 単体テスト実行
- コードフォーマットチェック

プルリクエストを作成すると、これらのチェックが自動で実行されます。

## 次のステップ

すべてのテストケースが成功したら:
1. コードレビューを依頼
2. PRをマージ
3. リリースノートに機能を記載
