# フォルダ読み込みパフォーマンス改善 - ユーザー向け説明

## 何が変わったか

大量の写真を含むフォルダを開くときの体感速度が劇的に向上しました。

### 従来の動作

- フォルダを開く → **10〜20秒待つ** → 全ての写真とサムネイルが表示される
- この間、アプリは応答せず、他の操作ができない

### 改善後の動作

- フォルダを開く → **0.5〜1秒で一覧表示** → サムネイルが順次表示される
- 一覧が表示されれば、サムネイル生成中でも他の操作ができる
- スクロール、選択、フォルダ移動など、すべて快適に動作

## 技術的な改善点

### 1. 初期表示の最適化

**従来**: すべての写真のサムネイルを生成してから表示
```
フォルダ読み込み → [サムネイル生成1] → [サムネイル生成2] → ... → 表示
```

**改善後**: プレースホルダーを即座に表示し、サムネイルは後で生成
```
フォルダ読み込み → 即座に表示（プレースホルダー）
                 ↓
            バックグラウンドでサムネイル生成（並列）
                 ↓
            完成したものから順次反映
```

### 2. バックグラウンド処理

- サムネイル生成を3つ並列で実行
- 300ミリ秒ごとにバッチ更新（UIをブロックしない）
- フォルダを切り替えると、前の処理を自動的にキャンセル

### 3. キャッシュの活用

- 以前に生成したサムネイルはキャッシュから即座に読み込み
- キャッシュがない写真だけバックグラウンドで生成

## 使い方

特別な操作は不要です。今まで通りフォルダを開くだけで、自動的に高速化の恩恵を受けられます。

### プレースホルダーについて

サムネイルが生成中の写真には、小さな画像アイコン（📷）が表示されます。数秒待つと、実際のサムネイルに置き換わります。

### 動作の違い

1. **フォルダを開く**: 
   - 即座にファイル名とプレースホルダーが表示される
   - サムネイルは数秒以内に順次表示される

2. **スクロール**: 
   - サムネイル生成中でもスムーズにスクロール可能

3. **フォルダ切り替え**: 
   - 前のフォルダのサムネイル生成を自動的に停止
   - 新しいフォルダの一覧を即座に表示

4. **選択**: 
   - サムネイル生成中でも選択や地図表示が可能

## パフォーマンス比較

| シナリオ | 従来 | 改善後 | 改善率 |
|---------|------|--------|--------|
| 100枚の写真（初回） | 10-20秒 | 0.5-1秒 | **95%短縮** |
| 100枚の写真（2回目） | 2-3秒 | 0.5-1秒 | 50%短縮 |
| フォルダ切り替え | 待ち時間あり | 即座 | **体感が劇的に向上** |

## 注意事項

### キャッシュについて

- サムネイルは `%LocalAppData%\PhotoGeoExplorer\Cache\Thumbnails` に保存されます
- 写真を編集・更新した場合、自動的に新しいサムネイルが生成されます
- キャッシュが溜まっても、自動的に古いものから削除されます（今後の改善予定）

### システム要件

- Windows 10/11
- .NET 10 Runtime
- WebView2 Runtime

### 既知の制限

1. **解像度ソート**: 
   - サムネイル生成後に解像度が判明するため、ソート順が変わる場合があります
   - その場合は、もう一度ソートボタンをクリックしてください

2. **大量の写真**: 
   - 1000枚以上の写真がある場合、すべてのサムネイル生成に数分かかる場合があります
   - ただし、一覧表示と操作は即座に可能です

## トラブルシューティング

### サムネイルが表示されない

1. 写真ファイルが壊れている可能性があります
2. ログを確認してください: `%LocalAppData%\PhotoGeoExplorer\Logs\app.log`

### アプリが遅い

1. 他のアプリを終了してメモリを確保してください
2. キャッシュフォルダを削除してみてください（自動的に再生成されます）

## フィードバック

問題や改善案があれば、GitHub Issues でお知らせください。

https://github.com/scottlz0310/PhotoGeoExplorer/issues
